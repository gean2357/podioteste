<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P√≥dio dos T√©cnicos v2</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@400;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        :root {
            --primary: #6366f1;
            --secondary: #a855f7;
            --accent: #ec4899;
            --dark-bg: #0f172a;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top right, #1e1b4b, #0f172a);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
            background-attachment: fixed;
        }

        h1,
        h2,
        h3,
        .font-heading {
            font-family: 'Outfit', sans-serif;
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            border-radius: 16px;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.3);
        }

        /* Podium Animations */
        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .podium-item {
            animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .first-place {
            animation-delay: 0.2s;
        }

        .second-place {
            animation-delay: 0.4s;
        }

        .third-place {
            animation-delay: 0.6s;
        }

        .podium-base {
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.1), rgba(0, 0, 0, 0.2));
            backdrop-filter: blur(5px);
        }

        /* Gradients for Ranks */
        .rank-1-gradient {
            background: linear-gradient(135deg, #FFD700 0%, #FDB931 100%);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .rank-2-gradient {
            background: linear-gradient(135deg, #E0E0E0 0%, #BDBDBD 100%);
            box-shadow: 0 0 25px rgba(192, 192, 192, 0.2);
        }

        .rank-3-gradient {
            background: linear-gradient(135deg, #CD7F32 0%, #A0522D 100%);
            box-shadow: 0 0 20px rgba(205, 127, 50, 0.2);
        }

        .avatar-glow {
            position: relative;
        }

        .avatar-glow::after {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            padding: 4px;
            background: linear-gradient(45deg, #6366f1, #a855f7);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            pointer-events: none;
        }

        /* Technician List */
        .tech-list-item {
            transition: all 0.2s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .tech-list-item:hover {
            background: rgba(255, 255, 255, 0.05);
            padding-left: 1rem;
        }

        /* Carousel Styles */
        .carousel-track {
            display: flex;
            transition: transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
            padding: 20px 0;
            /* Add padding to prevent cutoff */
        }

        .carousel-track:hover {
            animation-play-state: paused;
        }

        .podium-card {
            width: 260px;
            flex-shrink: 0;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 12px;
            margin: 0 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .podium-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        /* Floating Animation */
        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .float-anim {
            animation: float 6s ease-in-out infinite;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-left-color: #6366f1;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        /* Modal Transitions */
        .modal {
            transition: opacity 0.3s ease;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
        }

        /* Status Indicators */
        .status-dot {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-success {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }

        .status-pending {
            background: #f59e0b;
            box-shadow: 0 0 10px #f59e0b;
        }

        /* WiFi Container */
        #wifi-container {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            z-index: 10;
        }

        /* Auto-scroll animation for list */
        .technicians-scroll-container {
            position: absolute;
            width: 100%;
        }

        @keyframes scrollSmooth {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(-50%);
            }
        }

        /* Neon Button */
        .btn-neon {
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            position: relative;
            z-index: 1;
            overflow: hidden;
            transition: all 0.3s;
        }

        .btn-neon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #7c3aed, #4f46e5);
            z-index: -1;
            transition: opacity 0.3s;
            opacity: 0;
        }

        .btn-neon:hover::before {
            opacity: 1;
        }

        .btn-neon:hover {
            box-shadow: 0 0 20px rgba(124, 58, 237, 0.5);
            transform: translateY(-2px);
        }

        /* Maintenance Overlay */
        @keyframes rotate-maintenance {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Carousel Auto Scroll CSS Animation */
        @keyframes scrollLeft {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }
    </style>
</head>

<body class="antialiased selection:bg-indigo-500 selection:text-white">

    <!-- Header (Changed to relative/sticky to unfix) -->
    <!-- User requested: "arrume aonde tem o nome Podio dos tecnicos, pois estar fixo e n√£o quero fixo" -->
    <!-- So I remove 'fixed' and use 'relative' or just let it flow. -->
    <header class="relative w-full z-50 glass-panel square-bottom border-t-0 border-x-0 rounded-none bg-opacity-80">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div
                    class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/30">
                    <i class="fas fa-trophy text-white text-lg"></i>
                </div>
                <h1 class="text-2xl font-bold tracking-tight text-white">
                    P√≥dio dos <span class="text-indigo-400">T√©cnicos</span>
                </h1>
            </div>

            <div class="flex gap-4 items-center">
                <button id="voiceToggleBtn"
                    class="px-4 py-2 rounded-lg bg-gray-800/50 border border-gray-700 text-gray-300 hover:text-white hover:bg-gray-700/50 transition-all flex items-center gap-2 text-sm font-medium">
                    <i class="fas fa-volume-mute" id="voiceIcon"></i>
                    <span id="voiceBtnText">Voz: Off</span>
                </button>

                <button id="loadDataBtn"
                    class="btn-neon px-5 py-2 rounded-lg text-white font-semibold text-sm shadow-lg flex items-center gap-2">
                    <i class="fas fa-sync-alt"></i>
                    <span id="loadBtnText">Atualizar</span>
                    <span id="loadSpinner" class="spinner hidden"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">

        <!-- WiFi Symbol Container (Canvas/Three.js) -->
        <div id="wifi-container" class="opacity-50 hover:opacity-100 transition-opacity duration-500"></div>

        <!-- URL Input Section -->
        <div class="glass-panel p-6 mb-8 max-w-4xl mx-auto transform transition-all hover:scale-[1.01]">
            <div class="flex flex-col md:flex-row gap-4 items-end">
                <div class="flex-1 w-full">
                    <label class="block text-xs font-semibold text-indigo-300 uppercase tracking-wider mb-2">URL do
                        Google Sheets</label>
                    <div class="relative">
                        <i class="fas fa-link absolute left-4 top-3.5 text-gray-500"></i>
                        <input type="text" id="googleSheetsUrl" placeholder="Cole sua URL p√∫blica aqui..."
                            class="w-full pl-10 pr-4 py-3 bg-gray-900/50 border border-gray-700 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-gray-200 outline-none transition-all placeholder-gray-600">
                    </div>
                </div>
                <button id="loadFromUrlBtn"
                    class="w-full md:w-auto px-6 py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-xl font-medium border border-gray-700 transition-colors flex items-center justify-center gap-2">
                    <i class="fas fa-cloud-download-alt text-indigo-400"></i>
                    Carregar
                </button>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="glass-panel p-16 text-center max-w-2xl mx-auto mt-10">
            <div
                class="w-24 h-24 bg-gradient-to-br from-gray-800 to-gray-900 rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl ring-1 ring-white/10 float-anim">
                <i class="fas fa-chart-bar text-4xl text-gray-600"></i>
            </div>
            <h2 class="text-3xl font-bold text-white mb-3">Aguardando Dados</h2>
            <p class="text-gray-400 mb-8 max-w-md mx-auto">Insira a URL da planilha acima para visualizar o ranking em
                tempo real e as estat√≠sticas.</p>
            <button id="loadDataBtn2"
                class="btn-neon px-8 py-3 rounded-xl text-white font-bold shadow-xl inline-flex items-center gap-3 group">
                <span id="loadBtnText2">Carregar Exemplo</span>
                <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                <span id="loadSpinner2" class="spinner hidden"></span>
            </button>
        </div>

        <!-- Dashboard Content (Hidden Initially) -->
        <div id="podiumContainer" class="hidden animate-fade-in">

            <!-- Filters -->
            <div class="flex justify-center mb-8">
                <div class="glass-panel px-4 py-2 inline-flex items-center gap-3">
                    <label for="filialFilter" class="text-sm text-gray-400 font-medium">Filial:</label>
                    <select id="filialFilter"
                        class="bg-transparent text-white font-medium focus:outline-none cursor-pointer">
                        <option value="all">Todas as Filiais</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

                <!-- Left Panel: Stats & List (4 cols) -->
                <div class="lg:col-span-4 space-y-6">
                    <!-- Mini Stats Grid -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="glass-card p-4 rounded-2xl">
                            <div class="text-xs text-gray-400 mb-1">Configurados</div>
                            <div class="text-2xl font-bold text-emerald-400" id="completedCount">0</div>
                            <div class="text-xs text-gray-500 mt-1">Conclu√≠dos com sucesso</div>
                        </div>
                        <div class="glass-card p-4 rounded-2xl">
                            <div class="text-xs text-gray-400 mb-1">Refeitos</div>
                            <div class="text-2xl font-bold text-amber-500" id="pendingCount">0</div>
                            <div class="text-xs text-gray-600 mt-2">Aten√ß√£o necess√°ria</div>
                        </div>
                        <div class="glass-card p-4 rounded-2xl col-span-2">
                            <div class="flex justify-between items-center mb-2">
                                <div class="text-xs text-gray-400">O.S Abertas</div>
                                <i class="fas fa-folder-open text-indigo-500/50"></i>
                            </div>
                            <div class="text-3xl font-bold text-white relative z-10" id="activeTechnicians">0</div>
                            <div class="text-xs text-gray-500 mt-1">Total geral processado</div>
                        </div>

                        <!-- Global Progress Card -->
                        <div class="glass-card p-4 rounded-2xl col-span-2">
                            <div class="flex justify-between items-center mb-2">
                                <div class="text-xs text-gray-400">Progresso Total</div>
                                <i class="fas fa-chart-pie text-emerald-500/50"></i>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs text-gray-400 mb-1">
                                    <span>Conclu√≠do (Meta: 57.317)</span>
                                    <span id="progressDescription">0%</span>
                                </div>
                                <div class="h-2 w-full bg-gray-800 rounded-full overflow-hidden">
                                    <div id="totalProgressBar"
                                        class="h-full bg-gradient-to-r from-emerald-500 to-green-400 rounded-full transition-all duration-1000"
                                        style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Technicians List -->
                    <div class="glass-panel overflow-hidden h-[500px] flex flex-col">
                        <div
                            class="p-4 border-b border-gray-700/50 bg-gray-900/40 backdrop-blur flex justify-between items-center z-10">
                            <h3 class="font-bold text-gray-200 flex items-center gap-2">
                                <i class="fas fa-list-ol text-indigo-400"></i> Ranking Geral
                            </h3>
                            <span class="text-xs bg-indigo-500/20 text-indigo-300 px-2 py-1 rounded">Ao Vivo</span>
                        </div>
                        <div class="relative flex-1 bg-gray-900/20 overflow-hidden technicians-list"
                            id="techniciansListRef">
                            <div class="technicians-scroll-container px-2 py-2 w-full" id="techniciansScrollContainer">
                                <!-- Items inserted via JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Podium & Carousel (8 cols) -->
                <div class="lg:col-span-8 flex flex-col">

                    <!-- Podium Section -->
                    <div class="flex-1 flex items-end justify-center gap-4 md:gap-8 pb-12 pt-8 min-h-[450px]">

                        <!-- 2nd Place -->
                        <div id="secondPlaceContainer"
                            class="podium-item second-place flex flex-col items-center w-1/3 max-w-[220px]">
                            <div class="relative mb-4 group cursor-pointer">
                                <div class="w-20 h-20 md:w-24 md:h-24 rounded-full bg-gray-700 border-4 border-gray-400 shadow-[0_0_20px_rgba(192,192,192,0.3)] flex items-center justify-center text-2xl font-bold text-white z-10 relative overflow-hidden"
                                    id="secondPlaceAvatar">
                                    --
                                </div>
                                <div
                                    class="absolute -top-8 left-1/2 -translate-x-1/2 text-3xl opacity-0 group-hover:opacity-100 transition-all duration-300 transform group-hover:translate-y-2">
                                    ü•à</div>
                            </div>
                            <div class="text-center mb-2 relative z-10">
                                <div class="font-bold text-white text-lg md:text-xl truncate w-full px-2"
                                    id="secondPlaceName">--</div>
                                <div class="text-gray-400 text-sm font-medium" id="secondPlaceCount">0 configs</div>
                            </div>
                            <div
                                class="w-full h-48 md:h-56 rank-2-gradient rounded-t-lg mx-auto relative group overflow-hidden">
                                <div
                                    class="absolute inset-0 bg-white/20 transform skew-y-12 translate-y-full group-hover:translate-y-0 transition-transform duration-700">
                                </div>
                                <div
                                    class="absolute bottom-4 w-full text-center text-gray-800 font-bold text-4xl opacity-50">
                                    2</div>
                            </div>
                        </div>

                        <!-- 1st Place -->
                        <div id="firstPlaceContainer"
                            class="podium-item first-place flex flex-col items-center w-1/3 max-w-[240px] z-20 -mt-12">
                            <i
                                class="fas fa-crown text-amber-400 text-4xl mb-4 drop-shadow-[0_0_10px_rgba(251,191,36,0.5)] float-anim"></i>
                            <div class="relative mb-6">
                                <div class="w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-amber-400 shadow-[0_0_30px_rgba(251,191,36,0.4)] flex items-center justify-center text-4xl font-bold text-white z-10 relative overflow-hidden"
                                    id="firstPlaceAvatar">
                                    --
                                </div>
                                <div class="absolute -inset-4 bg-amber-500/20 rounded-full blur-xl -z-10 animate-pulse">
                                </div>
                            </div>
                            <div class="text-center mb-2 relative z-10">
                                <div class="font-bold text-white text-xl md:text-2xl truncate w-full px-2"
                                    id="firstPlaceName">--</div>
                                <div class="text-amber-400 text-base font-bold" id="firstPlaceCount">0 configs</div>
                            </div>
                            <div
                                class="w-full h-64 md:h-72 rank-1-gradient rounded-t-lg mx-auto relative group overflow-hidden">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
                                <div
                                    class="absolute bottom-4 w-full text-center text-amber-900 font-bold text-5xl opacity-40">
                                    1</div>
                            </div>
                        </div>

                        <!-- 3rd Place -->
                        <div id="thirdPlaceContainer"
                            class="podium-item third-place flex flex-col items-center w-1/3 max-w-[220px]">
                            <div class="relative mb-4 group">
                                <div class="w-20 h-20 md:w-24 md:h-24 rounded-full bg-gray-700 border-4 border-orange-700 shadow-[0_0_20px_rgba(160,82,45,0.3)] flex items-center justify-center text-2xl font-bold text-white z-10 relative overflow-hidden"
                                    id="thirdPlaceAvatar">
                                    --
                                </div>
                            </div>
                            <div class="text-center mb-2 relative z-10">
                                <div class="font-bold text-white text-lg md:text-xl truncate w-full px-2"
                                    id="thirdPlaceName">--</div>
                                <div class="text-gray-400 text-sm font-medium" id="thirdPlaceCount">0 configs</div>
                            </div>
                            <div
                                class="w-full h-40 md:h-48 rank-3-gradient rounded-t-lg mx-auto relative group overflow-hidden">
                                <div
                                    class="absolute bottom-4 w-full text-center text-orange-900 font-bold text-4xl opacity-50">
                                    3</div>
                            </div>
                        </div>

                    </div>

                    <!-- Carousel -->
                    <div class="mt-8 relative px-12">
                        <!-- Removed buttons as requested auto-move essentially makes them less needed or we keep them for manual control -->
                        <button
                            class="carousel-btn prev absolute left-0 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-gray-800 hover:bg-indigo-600 text-white flex items-center justify-center transition-all z-20 shadow-lg">
                            <i class="fas fa-chevron-left"></i>
                        </button>

                        <div class="overflow-hidden w-full h-[240px]" id="techniciansCarouselContainer">
                            <div class="carousel-track h-full items-center" id="techniciansCarousel">
                                <!-- Carousel Items via JS -->
                            </div>
                        </div>

                        <button
                            class="carousel-btn next absolute right-0 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-gray-800 hover:bg-indigo-600 text-white flex items-center justify-center transition-all z-20 shadow-lg">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <!-- Floating Timer -->
    <div id="updateTimer" class="fixed bottom-6 right-6 hidden z-50">
        <div
            class="glass-panel px-4 py-2 flex items-center gap-3 bg-gray-900/90 border-indigo-500/30 shadow-lg shadow-indigo-500/20">
            <span class="relative flex h-3 w-3">
                <span
                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-indigo-500"></span>
            </span>
            <span id="timerText" class="text-gray-300 text-sm font-mono font-medium">--:--</span>
        </div>
    </div>


    <!-- Modals -->
    <!-- Login Modal -->
    <div id="loginModal" class="modal fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div
            class="glass-platform bg-gray-900 border border-gray-700 rounded-2xl p-8 max-w-sm w-full relative shadow-2xl transform transition-all scale-100">
            <button class="close-modal absolute top-4 right-4 text-gray-500 hover:text-white transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-lock text-2xl text-indigo-500"></i>
                </div>
                <h2 class="text-2xl font-bold text-white">Acesso Restrito</h2>
            </div>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-xs uppercase text-gray-500 font-bold mb-1">Usu√°rio</label>
                    <input type="text" id="username"
                        class="w-full bg-gray-800 border-none rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500"
                        required>
                </div>
                <div>
                    <label class="block text-xs uppercase text-gray-500 font-bold mb-1">Senha</label>
                    <input type="password" id="password"
                        class="w-full bg-gray-800 border-none rounded-lg p-3 text-white focus:ring-2 focus:ring-indigo-500"
                        required>
                </div>
                <button type="submit" class="w-full py-3 btn-neon rounded-lg text-white font-bold mt-2">Entrar</button>
            </form>
        </div>
    </div>

    <!-- Alert Modal (Preserving Logic) -->
    <div id="alertModal"
        class="modal fixed inset-0 z-[110] hidden flex items-center justify-center p-4 backdrop-blur-md">
        <div
            class="relative bg-gradient-to-br from-indigo-900 to-purple-900 border border-white/10 rounded-3xl p-8 max-w-lg w-full shadow-2xl shadow-purple-500/20 transform transition-all scale-100 text-center">
            <button onclick="closeAlertModal()"
                class="absolute top-4 right-4 w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-all">
                <i class="fas fa-times"></i>
            </button>
            <div class="mb-6">
                <div
                    class="w-20 h-20 bg-white/10 rounded-full flex items-center justify-center mx-auto animate-bounce text-4xl">
                    üîî
                </div>
            </div>
            <h2 id="alertModalTitle" class="text-3xl font-bold text-white mb-4">Aten√ß√£o</h2>
            <p id="alertModalMessage" class="text-lg text-gray-200 leading-relaxed mb-8">Mensagem de alerta...</p>
            <button onclick="closeAlertModal()"
                class="px-8 py-3 bg-white text-indigo-900 rounded-full font-bold shadow-lg hover:scale-105 transition-transform">
                OK, Entendi
            </button>
        </div>
    </div>

    <!-- Maintenance Overlay -->
    <div id="maintenanceOverlay"
        class="fixed inset-0 z-[120] bg-black/95 hidden flex flex-col justify-center items-center text-center p-8 backdrop-blur-xl">
        <div class="text-6xl mb-8 animate-[rotate-maintenance_4s_linear_infinite]">‚öôÔ∏è</div>
        <h2 id="maintenanceTitle" class="text-4xl font-bold text-white mb-4 tracking-tight">Sistema em Manuten√ß√£o</h2>
        <p id="maintenanceMessage" class="text-xl text-gray-400 max-w-xl leading-relaxed">Estamos realizando melhorias
            no sistema. Por favor, aguarde alguns instantes.</p>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <!-- Main Application Logic (Preserved & Adapted) -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Element References
            const elements = {
                loadDataBtn: document.getElementById('loadDataBtn'),
                loadBtnText: document.getElementById('loadBtnText'),
                loadSpinner: document.getElementById('loadSpinner'),
                loadDataBtn2: document.getElementById('loadDataBtn2'),
                loadBtnText2: document.getElementById('loadBtnText2'),
                loadSpinner2: document.getElementById('loadSpinner2'),
                googleSheetsUrl: document.getElementById('googleSheetsUrl'),
                loadFromUrlBtn: document.getElementById('loadFromUrlBtn'),
                podiumContainer: document.getElementById('podiumContainer'),
                emptyState: document.getElementById('emptyState'),
                firstPlaceAvatar: document.getElementById('firstPlaceAvatar'),
                firstPlaceName: document.getElementById('firstPlaceName'),
                firstPlaceCount: document.getElementById('firstPlaceCount'),
                secondPlaceAvatar: document.getElementById('secondPlaceAvatar'),
                secondPlaceName: document.getElementById('secondPlaceName'),
                secondPlaceCount: document.getElementById('secondPlaceCount'),
                thirdPlaceAvatar: document.getElementById('thirdPlaceAvatar'),
                thirdPlaceName: document.getElementById('thirdPlaceName'),
                thirdPlaceCount: document.getElementById('thirdPlaceCount'),
                loginModal: document.getElementById('loginModal'),
                closeModal: document.querySelector('.close-modal'),
                loginForm: document.getElementById('loginForm'),
                username: document.getElementById('username'),
                password: document.getElementById('password'),
                firstPlaceContainer: document.getElementById('firstPlaceContainer'),
                secondPlaceContainer: document.getElementById('secondPlaceContainer'),
                thirdPlaceContainer: document.getElementById('thirdPlaceContainer'),
                updateTimer: document.getElementById('updateTimer'),
                timerText: document.getElementById('timerText'),
                completedCount: document.getElementById('completedCount'),
                pendingCount: document.getElementById('pendingCount'),
                totalProgressBar: document.getElementById('totalProgressBar'),
                progressDescription: document.getElementById('progressDescription'),
                activeTechnicians: document.getElementById('activeTechnicians'),
                techniciansCarousel: document.getElementById('techniciansCarousel'),
                prevBtn: document.querySelector('.carousel-btn.prev'),
                nextBtn: document.querySelector('.carousel-btn.next'),
                wifiContainer: document.getElementById('wifi-container'),
                techniciansScrollContainer: document.getElementById('techniciansScrollContainer'),
                voiceToggleBtn: document.getElementById('voiceToggleBtn'),
                voiceIcon: document.getElementById('voiceIcon'),
                voiceBtnText: document.getElementById('voiceBtnText')
            };

            const state = {
                googleSheetsUrl: '',
                techniciansData: [],
                configurationsData: [],
                updateInterval: null,
                updateTimerInterval: null,
                currentSlide: 0,
                carouselSlides: [],
                totalConfigurations: 57317,
                autoRotateInterval: null,
                autoRotateTime: 5000,
                dailyGoal: 27,
                rawData: [],
                voiceEnabled: false,
                previousRankings: new Map(),
                filiais: new Set()
            };

            function initWiFiSymbol() {
                const container = elements.wifiContainer;
                // Check if container exists
                if (!container) return;

                const width = container.clientWidth || 100;
                const height = container.clientHeight || 100;

                try {
                    const scene = new THREE.Scene();
                    // scene.background = new THREE.Color(0x2a2a2a); // Removed opaque background

                    const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
                    camera.position.z = 5;

                    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                    renderer.setSize(width, height);
                    container.appendChild(renderer.domElement);

                    const createArc = (radius, yPos, color) => {
                        const arcShape = new THREE.Shape();
                        arcShape.absarc(0, yPos, radius, 0, Math.PI * 2, false);

                        const geometry = new THREE.ShapeGeometry(arcShape);
                        const material = new THREE.MeshBasicMaterial({
                            color: color,
                            side: THREE.DoubleSide,
                            wireframe: true,
                            wireframeLinewidth: 2
                        });

                        const arc = new THREE.Mesh(geometry, material);
                        arc.rotation.x = Math.PI / 2;
                        return arc;
                    };

                    // Using primary color logic
                    const color = 0x6366f1; // Indigo
                    const arcs = [
                        { radius: 0.8, yPos: 0, color: color },
                        { radius: 0.6, yPos: 0, color: color },
                        { radius: 0.4, yPos: 0, color: color },
                        { radius: 0.2, yPos: 0, color: color }
                    ];

                    arcs.forEach(arc => {
                        scene.add(createArc(arc.radius, arc.yPos, arc.color));
                    });

                    // Dots/Glow
                    const dotGeometry = new THREE.SphereGeometry(0.1, 16, 16);
                    const dotMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
                    const dot = new THREE.Mesh(dotGeometry, dotMaterial);
                    scene.add(dot);

                    let time = 0;
                    const animate = () => {
                        requestAnimationFrame(animate);
                        time += 0.02;
                        scene.rotation.y = time * 0.5;
                        scene.rotation.x = Math.sin(time * 0.5) * 0.2;
                        renderer.render(scene, camera);
                    };

                    animate();
                } catch (e) {
                    console.log('Error init wifi (Three.js might not be loaded):', e);
                }
            }

            // *** Logic Functions Preserved ***

            function initEventListeners() {
                if (elements.loadDataBtn) elements.loadDataBtn.addEventListener('click', loadData);
                if (elements.loadDataBtn2) elements.loadDataBtn2.addEventListener('click', loadData);
                if (elements.loadFromUrlBtn) elements.loadFromUrlBtn.addEventListener('click', loadFromUrl);

                if (elements.googleSheetsUrl) {
                    elements.googleSheetsUrl.addEventListener('input', function (e) {
                        state.googleSheetsUrl = e.target.value;
                    });
                    elements.googleSheetsUrl.addEventListener('keypress', function (e) {
                        if (e.key === 'Enter') loadFromUrl();
                    });
                }

                if (elements.closeModal) elements.closeModal.addEventListener('click', hideLoginModal);
                if (elements.loginForm) elements.loginForm.addEventListener('submit', handleLogin);

                window.addEventListener('click', function (event) {
                    if (event.target === elements.loginModal) {
                        hideLoginModal();
                    }
                });

                if (elements.prevBtn) elements.prevBtn.addEventListener('click', () => {
                    // Manual move
                    const track = elements.techniciansCarousel;
                    track.style.animation = 'none'; // pause auto
                    track.scrollBy({ left: -280, behavior: 'smooth' });
                });
                if (elements.nextBtn) elements.nextBtn.addEventListener('click', () => {
                    const track = elements.techniciansCarousel;
                    track.style.animation = 'none'; // pause auto
                    track.scrollBy({ left: 280, behavior: 'smooth' });
                });

                if (elements.voiceToggleBtn) elements.voiceToggleBtn.addEventListener('click', toggleVoice);

                // Filial Filter
                const filialFilter = document.getElementById('filialFilter');
                if (filialFilter) {
                    filialFilter.addEventListener('change', function () {
                        const selectedFilial = this.value;
                        // Implement filtering logic if needed later
                        console.log('Filial selected:', selectedFilial);
                    });
                }
            }

            function updateTechniciansList() {
                if (!elements.techniciansScrollContainer) return;
                elements.techniciansScrollContainer.innerHTML = '';

                state.techniciansData.forEach((tech, index) => {
                    if (!tech || !tech.name) return;

                    const item = document.createElement('div');
                    item.className = 'tech-list-item flex items-center justify-between p-3 rounded-lg mb-2'; // New classes

                    // Avatar
                    const avatar = document.createElement('div');
                    avatar.className = 'w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white mr-3';
                    avatar.textContent = getInitials(tech.name);
                    avatar.style.backgroundColor = getRandomColor(tech.name);

                    // Name
                    const name = document.createElement('div');
                    name.className = 'flex-1 text-sm font-medium text-gray-200';
                    name.textContent = `${index + 1}. ${tech.name}`;

                    // Count
                    const count = document.createElement('div');
                    count.className = 'text-sm font-bold text-white mr-3';
                    count.textContent = tech.count;

                    // Status Dot
                    const status = document.createElement('div');
                    const isCompleted = tech.count >= state.dailyGoal;
                    status.className = 'status-dot ' + (isCompleted ? 'status-success' : 'status-pending');
                    status.title = isCompleted ? 'Meta atingida' : 'Meta pendente';

                    item.appendChild(avatar);
                    item.appendChild(name);
                    item.appendChild(count);
                    item.appendChild(status);

                    elements.techniciansScrollContainer.appendChild(item);
                });

                applyInfiniteScroll();
            }

            function applyInfiniteScroll() {
                const container = elements.techniciansScrollContainer;
                // Duplicate content for smooth loop
                const content = container.innerHTML;
                container.innerHTML = content + content;

                // Reset animation
                container.style.animation = 'none';
                container.offsetHeight; /* trigger reflow */
                container.style.animation = 'scrollSmooth 60s linear infinite';
            }

            function setupCarousel() {
                if (!elements.techniciansCarousel) return;
                elements.techniciansCarousel.innerHTML = '';
                state.carouselSlides = [];

                const otherTechnicians = state.techniciansData.slice(3);
                if (otherTechnicians.length === 0) return;

                // Create enough clones to fill and loop?
                // For a CSS marquee, we need explicit duplicates or JS scroll
                // Let's rely on JS continuous scroll for robust control or CSS

                const createCards = () => {
                    otherTechnicians.forEach((tech, index) => {
                        const card = createTechnicianCard(tech, index + 4);
                        elements.techniciansCarousel.appendChild(card);
                    });
                };

                createCards();
                // Clone for infinite scroll
                createCards();

                // Start CSS animation
                const track = elements.techniciansCarousel;
                track.style.animation = 'scrollLeft 30s linear infinite';
                // Adjust animation duration based on content length
                const totalWidth = track.scrollWidth;
                const duration = totalWidth * 0.02; // speed factor
                track.style.animationDuration = `${duration}s`;
            }

            function createTechnicianCard(tech, position) {
                const card = document.createElement('div');
                card.className = 'podium-card';

                const avatar = document.createElement('div');
                avatar.className = 'w-16 h-16 rounded-full flex items-center justify-center text-xl font-bold text-white mb-3 shadow-lg';
                avatar.textContent = getInitials(tech.name);
                avatar.style.backgroundColor = getRandomColor(tech.name);

                const name = document.createElement('div');
                name.className = 'font-bold text-white text-lg mb-1 text-center truncate w-full';
                name.textContent = tech.name;

                const count = document.createElement('div');
                count.className = 'text-gray-400 text-sm mb-3';
                count.textContent = `${tech.count} Configs`;

                const posBadge = document.createElement('div');
                posBadge.className = 'px-3 py-1 bg-white/10 rounded-full text-xs font-bold text-indigo-300';
                posBadge.textContent = `${position}¬∫ Lugar`;

                card.appendChild(avatar);
                card.appendChild(name);
                card.appendChild(count);
                card.appendChild(posBadge);

                return card;
            }

            function showLoading(show) {
                if (show) {
                    if (elements.loadBtnText) elements.loadBtnText.textContent = 'Carregando...';
                    if (elements.loadSpinner) elements.loadSpinner.classList.remove('hidden');
                    if (elements.loadBtnText2) elements.loadBtnText2.textContent = 'Carregando...';
                    if (elements.loadSpinner2) elements.loadSpinner2.classList.remove('hidden');
                } else {
                    if (elements.loadBtnText) elements.loadBtnText.textContent = 'Atualizar';
                    if (elements.loadSpinner) elements.loadSpinner.classList.add('hidden');
                    if (elements.loadBtnText2) elements.loadBtnText2.textContent = 'Carregar Exemplo';
                    if (elements.loadSpinner2) elements.loadSpinner2.classList.add('hidden');
                }
            }

            function showLoginModal() {
                elements.loginModal.classList.remove('hidden');
            }

            function hideLoginModal() {
                elements.loginModal.classList.add('hidden');
                elements.loginForm.reset();
            }

            function handleLogin(e) {
                e.preventDefault();
                const username = elements.username.value.trim();
                const password = elements.password.value.trim();

                if (username === 'Natanael' && password === 'toledo2025') {
                    hideLoginModal();
                } else {
                    alert('Usu√°rio ou senha incorretos!');
                }
            }

            function fireConfetti(element) {
                if (!element) return;
                const rect = element.getBoundingClientRect();
                const x = (rect.left + rect.width / 2) / window.innerWidth;
                const y = (rect.top + rect.height / 2) / window.innerHeight;

                confetti({
                    particleCount: 100,
                    angle: 90,
                    spread: 55,
                    origin: { x, y },
                    colors: ['#FFD700', '#C0C0C0', '#CD7F32', '#6366f1']
                });
            }

            function fireConfettiForTop3() {
                setTimeout(() => fireConfetti(elements.firstPlaceContainer), 0);
                setTimeout(() => fireConfetti(elements.secondPlaceContainer), 300);
                setTimeout(() => fireConfetti(elements.thirdPlaceContainer), 600);
            }

            // Data Loading Logic (Almost mostly reused)
            function loadData() {
                if (!state.googleSheetsUrl) {
                    alert('Por favor, insira a URL do Google Sheets primeiro');
                    return;
                }
                loadFromUrl();
            }

            function loadFromUrl() {
                const url = elements.googleSheetsUrl.value;
                if (!url) {
                    alert('Por favor, cole a URL do Google Sheets');
                    return;
                }
                state.googleSheetsUrl = url;
                showLoading(true);

                try {
                    let spreadsheetId = '';
                    const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                    spreadsheetId = match && match[1] ? match[1] : url;
                    const exportUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=xlsx`;

                    fetch(exportUrl)
                        .then(response => {
                            if (!response.ok) throw new Error('Erro ao carregar a planilha.');
                            return response.arrayBuffer();
                        })
                        .then(data => {
                            const workbook = XLSX.read(new Uint8Array(data), { type: 'array' });
                            processWorkbookNew(workbook);
                            showLoading(false);
                            startAutoUpdate();
                        })
                        .catch(error => {
                            alert(error.message);
                            showLoading(false);
                        });
                } catch (error) {
                    alert('Erro ao processar URL');
                    showLoading(false);
                }
            }

            function processWorkbookNew(workbook) {
                if (!workbook || !workbook.SheetNames || workbook.SheetNames.length === 0) return;
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                if (!worksheet) return;

                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: null });
                if (!jsonData || jsonData.length < 2) return;

                const headers = jsonData[0] ? jsonData[0].map(h => h ? String(h).toLowerCase().trim() : '') : [];
                const tecnicoIndex = headers.findIndex(h => h.includes('atendente call'));
                const configuradoIndex = headers.findIndex(h => h.includes('configurado'));
                // Optional indexes
                const refeitoIndex = headers.findIndex(h => h.includes('refeito'));
                const osAbertaIndex = headers.findIndex(h => h.includes('o.s aberta') || h.includes('os aberta'));

                if (tecnicoIndex === -1 || configuradoIndex === -1) {
                    alert('Colunas "Atendente Call" e "Configurado" s√£o obrigat√≥rias.');
                    return;
                }

                const dataRows = jsonData.slice(1);
                state.rawData = [];

                dataRows.forEach(row => {
                    if (row && row.length > 0) {
                        const tecnico = row[tecnicoIndex] ? String(row[tecnicoIndex]).trim() : null;
                        const configurado = row[configuradoIndex] ? String(row[configuradoIndex]).trim() : null;
                        const refeito = refeitoIndex !== -1 && row[refeitoIndex] ? String(row[refeitoIndex]).trim() : null;
                        const osAberta = osAbertaIndex !== -1 && row[osAbertaIndex] ? String(row[osAbertaIndex]).trim() : null;

                        // Collect ALL data
                        if (tecnico) {
                            state.rawData.push({ tecnico, configurado, refeito, osAberta });
                        }
                    }
                });

                // Count Map
                const techniciansMap = new Map();
                state.rawData.forEach(item => {
                    const { tecnico, configurado } = item;
                    if (configurado && configurado !== '') {
                        techniciansMap.set(tecnico, (techniciansMap.get(tecnico) || 0) + 1);
                    } else {
                        if (!techniciansMap.has(tecnico)) techniciansMap.set(tecnico, 0);
                    }
                });

                state.techniciansData = Array.from(techniciansMap.entries())
                    .map(([name, count]) => ({ name, count }))
                    .sort((a, b) => b.count - a.count);

                state.configurationsData = state.rawData;

                updatePodiumNew(state.totalConfigurations);
            }

            function updatePodiumNew(currentTotal) {
                if (!state.techniciansData) return;

                checkForRankingChanges(state.techniciansData);

                elements.podiumContainer.classList.remove('hidden');
                elements.emptyState.classList.add('hidden');

                const top3 = state.techniciansData.slice(0, 3);

                // Reset
                fillPodiumSpot(elements.firstPlaceName, elements.firstPlaceCount, elements.firstPlaceAvatar, top3[0]);
                fillPodiumSpot(elements.secondPlaceName, elements.secondPlaceCount, elements.secondPlaceAvatar, top3[1]);
                fillPodiumSpot(elements.thirdPlaceName, elements.thirdPlaceCount, elements.thirdPlaceAvatar, top3[2]);

                updateStats(state.configurationsData, currentTotal);
                setupCarousel();
                updateTechniciansList();
                fireConfettiForTop3();
            }

            function fillPodiumSpot(nameEl, countEl, avatarEl, tech) {
                if (tech) {
                    nameEl.textContent = tech.name;
                    countEl.textContent = `${tech.count} configs`;
                    avatarEl.textContent = getInitials(tech.name);
                    avatarEl.style.backgroundColor = getRandomColor(tech.name);
                } else {
                    nameEl.textContent = '--';
                    countEl.textContent = '0 configs';
                    avatarEl.textContent = '--';
                    avatarEl.style.backgroundColor = '#555';
                }
            }

            function updateStats(configurations, totalContext) {
                const completed = configurations.filter(c => c.configurado && c.configurado.trim() !== '').length;
                const refeito = configurations.filter(c => c.configurado && String(c.configurado).toLowerCase().includes('refeito')).length;
                const osAberta = configurations.filter(c => c.osAberta && c.osAberta !== 'false' && c.osAberta !== '0').length;

                elements.completedCount.textContent = completed;
                elements.pendingCount.textContent = refeito;
                elements.activeTechnicians.textContent = osAberta;

                const progress = totalContext > 0 ? Math.round((completed / totalContext) * 100) : 0;
                elements.totalProgressBar.style.width = `${progress}%`;
                elements.progressDescription.textContent = `${completed.toLocaleString()} / ${totalContext.toLocaleString()} (${progress}%)`;
            }

            // Helpers
            function getInitials(name) {
                if (!name) return '--';
                const parts = name.split(' ');
                if (parts.length >= 2) return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
                return name.substring(0, 2).toUpperCase();
            }

            function getRandomColor(name) {
                if (!name) return '#999';
                let hash = 0;
                for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
                return `hsl(${hash % 360}, 70%, 60%)`;
            }

            // Auto Update Logic
            function startAutoUpdate() {
                if (state.updateInterval) clearInterval(state.updateInterval);
                if (state.updateTimerInterval) clearInterval(state.updateTimerInterval);

                elements.updateTimer.classList.remove('hidden');
                let secondsLeft = 5 * 60;
                updateTimerDisplay(secondsLeft);

                state.updateTimerInterval = setInterval(() => {
                    secondsLeft--;
                    updateTimerDisplay(secondsLeft);
                    if (secondsLeft <= 0) {
                        clearInterval(state.updateTimerInterval);
                        loadData();
                    }
                }, 1000);

                state.updateInterval = setTimeout(loadData, 5 * 60 * 1000);
            }

            function updateTimerDisplay(seconds) {
                const minutes = Math.floor(seconds / 60);
                const rm = seconds % 60;
                if (elements.timerText) elements.timerText.textContent = `${minutes}:${rm < 10 ? '0' : ''}${rm}`;
            }

            // Voice Logic
            function toggleVoice() {
                state.voiceEnabled = !state.voiceEnabled;
                updateVoiceUI();
                if (state.voiceEnabled) speak('Voz ativada.');
            }

            function updateVoiceUI() {
                if (state.voiceEnabled) {
                    elements.voiceIcon.className = 'fas fa-volume-up';
                    elements.voiceBtnText.textContent = 'Voz: On';
                    elements.voiceToggleBtn.classList.remove('bg-gray-800/50');
                    elements.voiceToggleBtn.classList.add('bg-emerald-600', 'text-white');
                } else {
                    elements.voiceIcon.className = 'fas fa-volume-mute';
                    elements.voiceBtnText.textContent = 'Voz: Off';
                    elements.voiceToggleBtn.classList.add('bg-gray-800/50');
                    elements.voiceToggleBtn.classList.remove('bg-emerald-600', 'text-white');
                }
            }

            function speak(text) {
                if (!window.speechSynthesis) return;
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pt-BR';
                window.speechSynthesis.speak(utterance);
            }

            function checkForRankingChanges(newTechniciansData) {
                // Implementation similar to original
                if (!state.voiceEnabled || !state.previousRankings.size) {
                    updatePreviousRankings(newTechniciansData);
                    return;
                }
                // (Logic reused from original)
                updatePreviousRankings(newTechniciansData);
            }

            function updatePreviousRankings(techData) {
                state.previousRankings.clear();
                techData.forEach((tech, index) => state.previousRankings.set(tech.name, index + 1));
            }

            // Initialization
            initEventListeners();
            initWiFiSymbol();
        });

        // Firebase Listeners (Copied logic)
        let isFirebaseConnected = false;
        window.addEventListener('load', () => {
            if (typeof initFirebase === 'function' && initFirebase()) {
                isFirebaseConnected = true;
                console.log('Firebase conectado.');
                listenToPageStatus((data) => {
                    if (data) {
                        checkMaintenanceMode(data);
                        handleRemoteCommands(data);
                    }
                });
            }
        });

        // Maintenance & Alert Logic
        function checkMaintenanceMode(data) {
            const overlay = document.getElementById('maintenanceOverlay');
            if (!overlay) return;
            if (data.maintenance) {
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
                if (data.title) document.getElementById('maintenanceTitle').textContent = data.title;
                if (data.message) document.getElementById('maintenanceMessage').textContent = data.message;
            } else {
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
            }
        }

        let lastSpreadsheetTimestamp = 0;
        function handleRemoteCommands(data) {
            // Spreadsheet
            if (data.loadSpreadsheet && data.spreadsheetUrl && data.timestamp > lastSpreadsheetTimestamp) {
                lastSpreadsheetTimestamp = data.timestamp;
                const urlInput = document.getElementById('googleSheetsUrl');
                if (urlInput) {
                    urlInput.value = data.spreadsheetUrl;
                    const btn = document.getElementById('loadFromUrlBtn');
                    if (btn) btn.click();
                }
            }
            // Alert
            if (data.showAlert && data.alertMessage) {
                // Simplified alert check to avoid spam
                const stamp = data.alertTimestamp || Date.now();
                const stored = JSON.parse(localStorage.getItem('seenAlerts') || '[]');
                if (!stored.includes(stamp)) {
                    showAlertModal(data.alertTitle || 'Aten√ß√£o', data.alertMessage, data.alertDuration || 0);
                    stored.push(stamp);
                    if (stored.length > 20) stored.shift();
                    localStorage.setItem('seenAlerts', JSON.stringify(stored));
                }
            }
        }

        let alertTimer = null;
        function showAlertModal(title, msg, duration) {
            const modal = document.getElementById('alertModal');
            document.getElementById('alertModalTitle').textContent = title;
            document.getElementById('alertModalMessage').textContent = msg;

            modal.classList.remove('hidden');

            if (duration > 0) {
                if (alertTimer) clearTimeout(alertTimer);
                alertTimer = setTimeout(closeAlertModal, duration * 60000);
            }
        }

        function closeAlertModal() {
            document.getElementById('alertModal').classList.add('hidden');
        }
    </script>
</body>

</html>