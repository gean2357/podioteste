<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pódio dos Técnicos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            background-color: #2a2a2a;
            color: #e0e0e0;
        }

        .podium-step {
            transition: all 0.3s ease;
        }

        .podium-step:hover {
            transform: translateY(-5px);
        }

        .avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .laurel {
            position: absolute;
            top: -20px;
            width: 100%;
            height: 40px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20" fill="%23D4AF37"><path d="M20,10 Q50,20 80,10 Q50,0 20,10 Z"/></svg>');
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #333;
            margin: 10% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: modalopen 0.4s;
        }

        @keyframes modalopen {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: #888;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #555;
        }

        .input-field {
            position: relative;
            margin-bottom: 20px;
        }

        .input-field input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #444;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background-color: #444;
            color: #fff;
        }

        .input-field input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
            outline: none;
        }

        .input-field label {
            position: absolute;
            top: -10px;
            left: 10px;
            background: #333;
            padding: 0 5px;
            font-size: 14px;
            color: #6366f1;
        }

        .modal-btn {
            width: 100%;
            padding: 12px;
            background-color: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .modal-btn:hover {
            background-color: #4f46e5;
        }

        .modal-title {
            text-align: center;
            margin-bottom: 25px;
            color: #fff;
            font-size: 24px;
            font-weight: 700;
        }

        .modal-icon {
            text-align: center;
            margin-bottom: 20px;
            color: #6366f1;
            font-size: 40px;
        }

        .podium-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            height: 500px;
            margin-bottom: 20px;
            margin-top: 20px;
        }

        .podium-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .first-place {
            height: 400px;
        }

        .second-place {
            height: 350px;
        }

        .third-place {
            height: 300px;
        }

        .podium-platform {
            width: 220px;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 20px;
        }

        .podium-base {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            height: 60px;
        }

        .first-place .podium-base {
            background-color: #FFD700;
        }

        .second-place .podium-base {
            background-color: #C0C0C0;
        }

        .third-place .podium-base {
            background-color: #CD7F32;
        }

        .gold-gradient {
            background: linear-gradient(135deg, #FFD700 0%, #D4AF37 100%);
        }

        .silver-gradient {
            background: linear-gradient(135deg, #C0C0C0 0%, #A8A8A8 100%);
        }

        .bronze-gradient {
            background: linear-gradient(135deg, #CD7F32 0%, #A0522D 100%);
        }

        .podium-platform::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
        }

        .glow {
            box-shadow: 0 0 20px 5px rgba(255, 215, 0, 0.6);
            animation: glow-pulse 2s infinite alternate;
        }

        @keyframes glow-pulse {
            from {
                box-shadow: 0 0 10px 5px rgba(255, 215, 0, 0.4);
            }

            to {
                box-shadow: 0 0 25px 10px rgba(255, 215, 0, 0.8);
            }
        }

        .trophy-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.5rem;
        }

        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 10;
        }

        .progress-container {
            width: 100%;
            background-color: #444;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .progress-bar {
            height: 20px;
            border-radius: 8px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .progress-completed {
            background-color: #10b981;
        }

        .progress-pending {
            background-color: #ef4444;
        }

        .configurations-container {
            background-color: #333;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            margin-right: 20px;
            flex: 1;
        }

        .config-header {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #6366f1;
            text-align: center;
        }

        .config-section {
            margin-bottom: 30px;
        }

        .config-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #fff;
            border-bottom: 2px solid #6366f1;
            padding-bottom: 5px;
        }

        .config-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .config-item {
            background-color: #444;
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .config-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .config-name {
            font-weight: 500;
        }

        .config-status {
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .completed {
            background-color: #10b981;
            color: white;
            animation: neon-green 1.5s infinite alternate;
        }

        .pending {
            background-color: #ef4444;
            color: white;
            animation: neon-red 1.5s infinite alternate;
        }

        @keyframes neon-green {
            from {
                box-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
            }

            to {
                box-shadow: 0 0 15px rgba(16, 185, 129, 0.8);
            }
        }

        @keyframes neon-red {
            from {
                box-shadow: 0 0 5px rgba(239, 68, 68, 0.5);
            }

            to {
                box-shadow: 0 0 15px rgba(239, 68, 68, 0.8);
            }
        }

        .config-list::-webkit-scrollbar {
            width: 6px;
        }

        .config-list::-webkit-scrollbar-track {
            background: #444;
            border-radius: 10px;
        }

        .config-list::-webkit-scrollbar-thumb {
            background: #6366f1;
            border-radius: 10px;
        }

        .config-list::-webkit-scrollbar-thumb:hover {
            background: #4f46e5;
        }

        .main-content-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .left-panel {
            flex: 1;
            position: relative;
        }

        .right-panel {
            width: 60%;
        }

        .stats-card {
            background-color: #333;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stats-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #fff;
            display: flex;
            align-items: center;
        }

        .stats-title i {
            margin-right: 10px;
            color: #6366f1;
        }

        .stats-value {
            font-size: 28px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }

        .stats-description {
            font-size: 14px;
            color: #ccc;
        }

        .update-timer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #4f46e5;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: flex;
            align-items: center;
        }

        .update-timer i {
            margin-right: 8px;
        }

        .online-badge {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: #10b981;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }

        .carousel-container {
            width: 100%;
            overflow: hidden;
            margin: 30px 0;
            position: relative;
        }

        .carousel-track {
            display: flex;
            transition: transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1);
            align-items: center;
            height: 350px;
        }

        .carousel-slide {
            min-width: 100%;
            padding: 0 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .carousel-nav {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .carousel-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #555;
            margin: 0 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .carousel-dot.active {
            background-color: #6366f1;
        }

        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .carousel-btn:hover {
            background-color: rgba(0, 0, 0, 0.7);
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-btn.prev {
            left: 10px;
        }

        .carousel-btn.next {
            right: 10px;
        }

        .carousel-wrapper {
            position: relative;
            width: 100%;
        }

        .podium-purple {
            background: linear-gradient(135deg, #8A2BE2 0%, #9932CC 100%);
        }

        .podium-blue {
            background: linear-gradient(135deg, #1E90FF 0%, #4169E1 100%);
        }

        .podium-green {
            background: linear-gradient(135deg, #2E8B57 0%, #3CB371 100%);
        }

        .podium-red {
            background: linear-gradient(135deg, #FF4500 0%, #DC143C 100%);
        }

        .podium-orange {
            background: linear-gradient(135deg, #FF8C00 0%, #FFA500 100%);
        }

        .podium-pink {
            background: linear-gradient(135deg, #FF69B4 0%, #DB7093 100%);
        }

        .podium-teal {
            background: linear-gradient(135deg, #008080 0%, #20B2AA 100%);
        }

        .podium-indigo {
            background: linear-gradient(135deg, #4B0082 0%, #6A5ACD 100%);
        }

        .podium-card {
            width: 280px;
            height: 350px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding-bottom: 20px;
            position: relative;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            margin: 0 auto;
            transition: transform 0.5s ease, opacity 0.5s ease;
            transform: scale(0.9);
            opacity: 0.7;
        }

        .podium-card.active {
            transform: scale(1);
            opacity: 1;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
        }

        .podium-card-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #555;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            font-size: 28px;
        }

        .podium-card-name {
            font-weight: bold;
            font-size: 22px;
            color: white;
            margin-bottom: 5px;
            text-align: center;
            padding: 0 10px;
        }

        .podium-card-count {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 15px;
        }

        .podium-card-position {
            width: 100%;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 22px;
            border-radius: 0 0 8px 8px;
        }

        .podium-cards-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 40px;
        }

        .auto-rotate-indicator {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #888;
            display: flex;
            align-items: center;
        }

        .auto-rotate-indicator i {
            margin-right: 5px;
        }

        #wifi-container {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            z-index: 10;
        }

        @media (max-width: 1024px) {
            .main-content-container {
                flex-direction: column;
            }

            .right-panel {
                width: 100%;
            }

            .podium-container {
                height: auto;
                flex-direction: column;
                align-items: center;
            }

            .podium-item {
                margin-bottom: 20px;
            }

            .first-place,
            .second-place,
            .third-place {
                height: 300px;
            }

            .carousel-track {
                height: 300px;
            }
        }

        .technicians-list-container {
            background-color: #333;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
            height: 400px;
            overflow: hidden;
            position: relative;
        }

        .technicians-list-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .technicians-list-title i {
            color: #6366f1;
            margin-right: 10px;
        }

        .technicians-list {
            height: 350px;
            overflow-y: hidden;
            position: relative;
        }

        .technicians-scroll-container {
            position: absolute;
            width: 100%;
            animation: scrollTechnicians 30s linear infinite;
        }

        @keyframes scrollTechnicians {
            0% {
                transform: translateY(0);
            }

            100% {
                transform: translateY(calc(-100% + 350px));
            }
        }

        .technician-item {
            background-color: #444;
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .technician-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .technician-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #555;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 10px;
        }

        .technician-name {
            flex: 1;
            font-weight: 500;
            color: #fff;
        }

        .technician-count {
            font-weight: bold;
            color: #fff;
            min-width: 60px;
            text-align: right;
            margin-right: 10px;
        }

        .technician-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-completed {
            background-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
        }

        .status-pending {
            background-color: #ef4444;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
        }

        .daily-goal {
            display: inline-block;
            background-color: #6366f1;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>

<body class="font-sans min-h-screen">


    <header class="bg-indigo-800 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">Pódio dos Técnicos</h1>
            <div class="flex gap-2">
                <button id="voiceToggleBtn"
                    class="bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-4 rounded-md flex items-center transition-colors">
                    <i class="fas fa-volume-mute mr-2" id="voiceIcon"></i>
                    <span id="voiceBtnText">Voz: Off</span>
                </button>
                <button id="loadDataBtn"
                    class="bg-indigo-600 hover:bg-indigo-500 text-white font-medium py-2 px-4 rounded-md flex items-center">
                    <i class="fas fa-sync-alt mr-2"></i>
                    <span id="loadBtnText">Carregar Dados</span>
                    <span id="loadSpinner" class="loading-spinner hidden ml-2"></span>
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4">
        <!-- Google Sheets URL  -->
        <div class="bg-gray-700 rounded-lg shadow p-4 mb-6">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1">
                    <label class="block text-sm font-medium text-gray-300 mb-1">URL do Google Sheets</label>
                    <input type="text" id="googleSheetsUrl" placeholder="Cole a URL pública do Google Sheets"
                        class="w-full px-3 py-2 border border-gray-600 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 bg-gray-600 text-white">
                </div>
                <div class="flex items-end">
                    <button id="loadFromUrlBtn"
                        class="bg-indigo-600 hover:bg-indigo-500 text-white font-medium py-2 px-4 rounded-md h-10 flex items-center">
                        <i class="fas fa-link mr-2"></i> Carregar
                    </button>
                </div>
            </div>
            <p class="text-sm text-gray-400 mt-2">A planilha deve conter colunas com os nomes "Atendente Call" e
                "Configurado"</p>
        </div>

        <div id="podiumContainer" class="hidden">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-white mb-2">Destaques e Configurações</h2>
                <div class="flex justify-center items-center gap-4 mt-4">
                    <label for="filialFilter" class="text-gray-300 font-medium">Filtrar por Filial:</label>
                    <select id="filialFilter"
                        class="bg-gray-700 text-white border border-gray-600 rounded-md px-4 py-2 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="all">Geral (Todas as Filiais)</option>
                    </select>
                </div>
            </div>

            <div class="main-content-container">
                <div class="left-panel">
                    <div class="stats-grid grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="stats-card">
                            <div class="stats-title">
                                <i class="fas fa-check-circle"></i>
                                Configurações Concluídas
                            </div>
                            <div class="stats-value" id="completedCount">0</div>
                            <div class="stats-description">Total de configurações finalizadas</div>
                        </div>

                        <div class="stats-card">
                            <div class="stats-title">
                                <i class="fas fa-redo"></i>
                                Configurações Refeitas
                            </div>
                            <div class="stats-value" id="pendingCount">0</div>
                            <div class="stats-description">Refeito configuração - Quantidade refeita</div>
                        </div>

                        <div class="stats-card">
                            <div class="stats-title">
                                <i class="fas fa-chart-line"></i>
                                Progresso Total
                            </div>
                            <div class="progress-container">
                                <div class="progress-bar progress-completed" id="totalProgressBar" style="width: 0%">0%
                                </div>
                            </div>
                            <div class="stats-description mt-2" id="progressDescription">0 de 21742 configurações
                                concluídas</div>
                        </div>

                        <div class="stats-card">
                            <div class="stats-title">
                                <i class="fas fa-folder-open"></i>
                                O.S ABERTA
                            </div>
                            <div class="stats-value" id="activeTechnicians">0</div>
                            <div class="stats-description">Quantidade de O.S abertas</div>
                        </div>
                    </div>

                    <div class="technicians-list-container">
                        <div class="technicians-list-title">
                            <div>
                                <i class="fas fa-list-ol"></i>
                                Lista de Técnicos
                                <span class="daily-goal">Configurados</span>
                            </div>
                        </div>
                        <div class="technicians-list">
                            <div class="technicians-scroll-container" id="techniciansScrollContainer">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="right-panel">
                    <div class="podium-container">
                        <div class="podium-item second-place" id="secondPlaceContainer">
                            <div class="confetti-container" id="secondConfetti"></div>
                            <div class="podium-platform silver-gradient relative">
                                <div class="laurel"></div>
                                <div class="trophy-icon">
                                    <i class="fas fa-medal"></i>
                                </div>
                                <div class="avatar w-24 h-24 mb-4 text-3xl" id="secondPlaceAvatar">--</div>
                                <span class="font-bold text-gray-800 text-xl" id="secondPlaceName">--</span>
                                <span class="text-md text-gray-700 font-medium" id="secondPlaceCount">0
                                    configurações</span>
                            </div>
                            <div class="podium-base">
                                <span class="podium-number">2º Lugar</span>
                            </div>
                        </div>

                        <div class="podium-item first-place" id="firstPlaceContainer">
                            <div class="confetti-container" id="firstConfetti"></div>
                            <div class="podium-platform gold-gradient relative glow">
                                <div class="laurel"></div>
                                <div class="trophy-icon">
                                    <i class="fas fa-crown"></i>
                                </div>
                                <div class="avatar w-28 h-28 mb-4 text-4xl" id="firstPlaceAvatar">--</div>
                                <span class="font-bold text-gray-800 text-2xl" id="firstPlaceName">--</span>
                                <span class="text-lg text-gray-700 font-medium" id="firstPlaceCount">0
                                    configurações</span>
                            </div>
                            <div class="podium-base">
                                <span class="podium-number">1º Lugar</span>
                            </div>
                        </div>

                        <div class="podium-item third-place" id="thirdPlaceContainer">
                            <div class="confetti-container" id="thirdConfetti"></div>
                            <div class="podium-platform bronze-gradient relative">
                                <div class="laurel"></div>
                                <div class="trophy-icon">
                                    <i class="fas fa-award"></i>
                                </div>
                                <div class="avatar w-20 h-20 mb-3 text-2xl" id="thirdPlaceAvatar">--</div>
                                <span class="font-bold text-gray-800 text-lg" id="thirdPlaceName">--</span>
                                <span class="text-sm text-gray-700 font-medium" id="thirdPlaceCount">0
                                    configurações</span>
                            </div>
                            <div class="podium-base">
                                <span class="podium-number">3º Lugar</span>
                            </div>
                        </div>
                    </div>

                    <div class="carousel-wrapper">
                        <h3 class="text-xl font-semibold text-white mb-4 text-center">Outros Técnicos</h3>
                        <div class="carousel-container">
                            <div class="carousel-track" id="techniciansCarousel">
                            </div>
                            <button class="carousel-btn prev">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="carousel-btn next">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="auto-rotate-indicator">
                            <i class="fas fa-sync-alt"></i>
                            <span>Passagem automática ativada</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="emptyState" class="bg-gray-700 rounded-xl shadow-md p-8 text-center mt-8">
            <div class="text-indigo-500 mb-4">
                <i class="fas fa-trophy text-5xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-white mb-2">Pódio dos Técnicos</h2>
            <p class="text-gray-400 mb-6">Carregue os dados da planilha para visualizar o ranking dos técnicos com mais
                configurações realizadas.</p>
            <button id="loadDataBtn2"
                class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded-lg shadow cursor-pointer transition duration-300 inline-flex items-center">
                <i class="fas fa-link mr-2"></i>
                <span id="loadBtnText2">Carregar Dados</span>
                <span id="loadSpinner2" class="loading-spinner hidden ml-2"></span>
            </button>
        </div>
    </main>

    <div id="updateTimer" class="update-timer hidden">
        <i class="fas fa-clock"></i>
        <span id="timerText">Próxima atualização em 5:00</span>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h2 class="modal-title">Acesso Restrito</h2>
            <form id="loginForm">
                <div class="input-field">
                    <input type="text" id="username" required>
                    <label for="username">Usuário</label>
                </div>
                <div class="input-field">
                    <input type="password" id="password" required>
                    <label for="password">Senha</label>
                </div>
                <button type="submit" class="modal-btn">
                    Entrar
                </button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const elements = {
                loadDataBtn: document.getElementById('loadDataBtn'),
                loadBtnText: document.getElementById('loadBtnText'),
                loadSpinner: document.getElementById('loadSpinner'),
                loadDataBtn2: document.getElementById('loadDataBtn2'),
                loadBtnText2: document.getElementById('loadBtnText2'),
                loadSpinner2: document.getElementById('loadSpinner2'),
                googleSheetsUrl: document.getElementById('googleSheetsUrl'),
                loadFromUrlBtn: document.getElementById('loadFromUrlBtn'),
                podiumContainer: document.getElementById('podiumContainer'),
                emptyState: document.getElementById('emptyState'),
                firstPlaceAvatar: document.getElementById('firstPlaceAvatar'),
                firstPlaceName: document.getElementById('firstPlaceName'),
                firstPlaceCount: document.getElementById('firstPlaceCount'),
                secondPlaceAvatar: document.getElementById('secondPlaceAvatar'),
                secondPlaceName: document.getElementById('secondPlaceName'),
                secondPlaceCount: document.getElementById('secondPlaceCount'),
                thirdPlaceAvatar: document.getElementById('thirdPlaceAvatar'),
                thirdPlaceName: document.getElementById('thirdPlaceName'),
                thirdPlaceCount: document.getElementById('thirdPlaceCount'),
                loginModal: document.getElementById('loginModal'),
                closeModal: document.querySelector('.close-modal'),
                loginForm: document.getElementById('loginForm'),
                username: document.getElementById('username'),
                password: document.getElementById('password'),
                firstPlaceContainer: document.getElementById('firstPlaceContainer'),
                secondPlaceContainer: document.getElementById('secondPlaceContainer'),
                thirdPlaceContainer: document.getElementById('thirdPlaceContainer'),
                updateTimer: document.getElementById('updateTimer'),
                timerText: document.getElementById('timerText'),
                completedCount: document.getElementById('completedCount'),
                pendingCount: document.getElementById('pendingCount'),
                totalProgressBar: document.getElementById('totalProgressBar'),
                progressDescription: document.getElementById('progressDescription'),
                activeTechnicians: document.getElementById('activeTechnicians'),
                techniciansCarousel: document.getElementById('techniciansCarousel'),
                prevBtn: document.querySelector('.carousel-btn.prev'),
                nextBtn: document.querySelector('.carousel-btn.next'),
                wifiContainer: document.getElementById('wifi-container'),
                wifiContainer: document.getElementById('wifi-container'),
                techniciansScrollContainer: document.getElementById('techniciansScrollContainer'),
                voiceToggleBtn: document.getElementById('voiceToggleBtn'),
                voiceIcon: document.getElementById('voiceIcon'),
                voiceBtnText: document.getElementById('voiceBtnText')
            };

            const state = {
                googleSheetsUrl: '',
                techniciansData: [],
                configurationsData: [],
                updateInterval: null,
                updateTimerInterval: null,
                currentSlide: 0,
                carouselSlides: [],
                totalConfigurations: 57317, // Total fixo de configurações
                autoRotateInterval: null,
                autoRotateTime: 5000, 
                dailyGoal: 27, 
                rawData: [], 
                voiceEnabled: false,
                previousRankings: new Map() 
            };

            function initWiFiSymbol() {
                const container = elements.wifiContainer;
                const width = container.clientWidth;
                const height = container.clientHeight;

                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0x2a2a2a);

                const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
                camera.position.z = 5;

                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(width, height);
                container.appendChild(renderer.domElement);

                const createArc = (radius, yPos, color) => {
                    const arcShape = new THREE.Shape();
                    arcShape.absarc(0, yPos, radius, 0, Math.PI * 2, false);

                    const geometry = new THREE.ShapeGeometry(arcShape);
                    const material = new THREE.MeshBasicMaterial({
                        color: color,
                        side: THREE.DoubleSide,
                        wireframe: true,
                        wireframeLinewidth: 3
                    });

                    const arc = new THREE.Mesh(geometry, material);
                    arc.rotation.x = Math.PI / 2;
                    return arc;
                };

                const arcs = [
                    { radius: 0.8, yPos: 0, color: 0x10b981 },
                    { radius: 0.6, yPos: 0, color: 0x10b981 },
                    { radius: 0.4, yPos: 0, color: 0x10b981 },
                    { radius: 0.2, yPos: 0, color: 0x10b981 }
                ];

                arcs.forEach(arc => {
                    scene.add(createArc(arc.radius, arc.yPos, arc.color));
                });

                const dotGeometry = new THREE.SphereGeometry(0.05, 16, 16);
                const dotMaterial = new THREE.MeshBasicMaterial({ color: 0x10b981 });
                const dot = new THREE.Mesh(dotGeometry, dotMaterial);
                scene.add(dot);

                const glowGeometry = new THREE.SphereGeometry(0.15, 16, 16);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: 0x10b981,
                    transparent: true,
                    opacity: 0.5
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                scene.add(glow);

                let time = 0;
                const animate = () => {
                    requestAnimationFrame(animate);

                    time += 0.01;
                    glow.scale.set(1 + Math.sin(time) * 0.2, 1 + Math.sin(time) * 0.2, 1);

                    renderer.render(scene, camera);
                };

                animate();

                window.addEventListener('resize', () => {
                    camera.aspect = container.clientWidth / container.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(container.clientWidth, container.clientHeight);
                });
            }

            function initEventListeners() {
                elements.loadDataBtn.addEventListener('click', loadData);
                elements.loadDataBtn2.addEventListener('click', loadData);
                elements.loadFromUrlBtn.addEventListener('click', loadFromUrl);

                // Google Sheets URL 
                elements.googleSheetsUrl.addEventListener('input', function (e) {
                    state.googleSheetsUrl = e.target.value;
                });
                elements.googleSheetsUrl.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') loadFromUrl();
                });

                elements.closeModal.addEventListener('click', hideLoginModal);
                elements.loginForm.addEventListener('submit', handleLogin);

                window.addEventListener('click', function (event) {
                    if (event.target === elements.loginModal) {
                        hideLoginModal();
                    }
                });

                elements.prevBtn.addEventListener('click', () => moveCarousel(-1));
                elements.nextBtn.addEventListener('click', () => moveCarousel(1));

                elements.voiceToggleBtn.addEventListener('click', toggleVoice);
            }

            function updateTechniciansList() {
                elements.techniciansScrollContainer.innerHTML = '';

                state.techniciansData.forEach((tech, index) => {
                    if (!tech || !tech.name) return;

                    const item = document.createElement('div');
                    item.className = 'technician-item';

                    const avatar = document.createElement('div');
                    avatar.className = 'technician-avatar';
                    avatar.textContent = getInitials(tech.name);
                    avatar.style.backgroundColor = getRandomColor(tech.name);

                    const name = document.createElement('div');
                    name.className = 'technician-name';
                    name.textContent = `${index + 1}. ${tech.name}`;

                    const count = document.createElement('div');
                    count.className = 'technician-count';
                    count.textContent = tech.count;

                    const status = document.createElement('div');
                    status.className = 'technician-status ' + (tech.count >= state.dailyGoal ? 'status-completed' : 'status-pending');

                    status.title = tech.count >= state.dailyGoal
                        ? `Bateu a meta diária de ${state.dailyGoal} configurações!`
                        : `Ainda não bateu a meta diária de ${state.dailyGoal} configurações`;

                    item.appendChild(avatar);
                    item.appendChild(name);
                    item.appendChild(count);
                    item.appendChild(status);

                    elements.techniciansScrollContainer.appendChild(item);
                });

                restartScrollingAnimation();
            }

            function restartScrollingAnimation() {
                const scrollContainer = document.querySelector('.technicians-scroll-container');
                scrollContainer.style.animation = 'none';
                scrollContainer.offsetHeight; 

                scrollContainer.style.animation = 'scrollTechnicians 30s linear infinite';
            }

            function setupCarousel() {
                elements.techniciansCarousel.innerHTML = '';
                state.carouselSlides = [];

                const otherTechnicians = state.techniciansData.slice(3);

                if (otherTechnicians.length === 0) return;

                otherTechnicians.forEach((tech, index) => {
                    const slide = document.createElement('div');
                    slide.className = 'carousel-slide';

                    const card = createTechnicianCard(tech, index + 4);
                    slide.appendChild(card);

                    elements.techniciansCarousel.appendChild(slide);
                    state.carouselSlides.push(slide);
                });

                updateCarousel();

                startAutoRotate();
            }

            function createTechnicianCard(tech, position) {
                const podiumColors = [
                    'podium-purple', 'podium-blue', 'podium-green',
                    'podium-red', 'podium-orange', 'podium-pink',
                    'podium-teal', 'podium-indigo'
                ];

                const card = document.createElement('div');
                card.className = 'podium-card';

                const colorClass = podiumColors[position % podiumColors.length];
                card.classList.add(colorClass);

                const avatar = document.createElement('div');
                avatar.className = 'podium-card-avatar';
                avatar.textContent = getInitials(tech.name);
                avatar.style.backgroundColor = getRandomColor(tech.name);

                const name = document.createElement('div');
                name.className = 'podium-card-name';
                name.textContent = tech.name;

                const count = document.createElement('div');
                count.className = 'podium-card-count';
                count.textContent = `${tech.count} configuraç${tech.count !== 1 ? 'ões' : ''}`;

                const positionEl = document.createElement('div');
                positionEl.className = 'podium-card-position';
                positionEl.textContent = `${position}º`;

                card.appendChild(avatar);
                card.appendChild(name);
                card.appendChild(count);
                card.appendChild(positionEl);

                return card;
            }

            function moveCarousel(direction) {
                stopAutoRotate();

                const numSlides = state.carouselSlides.length;
                if (numSlides === 0) return;

                state.currentSlide = (state.currentSlide + direction + numSlides) % numSlides;
                updateCarousel();

                setTimeout(startAutoRotate, state.autoRotateTime * 2);
            }

            function updateCarousel() {
                const track = elements.techniciansCarousel;
                const slideWidth = track.clientWidth;

                track.style.transform = `translateX(-${state.currentSlide * slideWidth}px)`;

                state.carouselSlides.forEach((slide, index) => {
                    const card = slide.querySelector('.podium-card');
                    if (card) {
                        if (index === state.currentSlide) {
                            card.classList.add('active');
                        } else {
                            card.classList.remove('active');
                        }
                    }
                });
            }

            function startAutoRotate() {
                stopAutoRotate();

                state.autoRotateInterval = setInterval(() => {
                    moveCarousel(1);
                }, state.autoRotateTime);
            }

            function stopAutoRotate() {
                if (state.autoRotateInterval) {
                    clearInterval(state.autoRotateInterval);
                    state.autoRotateInterval = null;
                }
            }

            function showLoading(show) {
                if (show) {
                    elements.loadBtnText.textContent = 'Carregando...';
                    elements.loadSpinner.classList.remove('hidden');
                    elements.loadBtnText2.textContent = 'Carregando...';
                    elements.loadSpinner2.classList.remove('hidden');
                } else {
                    elements.loadBtnText.textContent = 'Carregar Dados';
                    elements.loadSpinner.classList.add('hidden');
                    elements.loadBtnText2.textContent = 'Carregar Dados';
                    elements.loadSpinner2.classList.add('hidden');
                }
            }

            function showLoginModal() {
                elements.loginModal.style.display = 'block';
            }

            function hideLoginModal() {
                elements.loginModal.style.display = 'none';
                elements.loginForm.reset();
            }

            function handleLogin(e) {
                e.preventDefault();
                const username = elements.username.value.trim();
                const password = elements.password.value.trim();

                if (username === 'Natanael' && password === 'toledo2025') {
                    hideLoginModal();
                } else {
                    alert('Usuário ou senha incorretos!');
                }
            }

            function fireConfetti(element) {
                const rect = element.getBoundingClientRect();
                const x = (rect.left + rect.width / 2) / window.innerWidth;
                const y = (rect.top + rect.height / 2) / window.innerHeight;

                confetti({
                    particleCount: 100,
                    angle: 90,
                    spread: 45,
                    origin: { x, y },
                    colors: ['#FFD700', '#C0C0C0', '#CD7F32', '#ffffff']
                });
            }

            function fireConfettiForTop3() {
                setTimeout(() => {
                    fireConfetti(elements.firstPlaceContainer);
                }, 0);

                setTimeout(() => {
                    fireConfetti(elements.secondPlaceContainer);
                }, 300);

                setTimeout(() => {
                    fireConfetti(elements.thirdPlaceContainer);
                }, 600);
            }

            function updateConfigurationsList(configurations, totalContext) {
                const completed = configurations.filter(config => config.configurado && config.configurado.trim() !== '').length;

                const refeito = configurations.filter(config => {
                    if (!config.configurado) return false;
                    const value = String(config.configurado).trim().toLowerCase();
                    return value === 'refeito configuração' || value === 'refeito configuracao';
                }).length;

                const osAberta = configurations.filter(config => {
                    if (!config.osAberta) return false;
                    const value = String(config.osAberta).toLowerCase().trim();
                    return value !== '' && value !== 'false' && value !== 'falso' && value !== '0';
                }).length;

                elements.completedCount.textContent = completed;
                elements.pendingCount.textContent = refeito; // Agora mostra configurações refeitas
                elements.activeTechnicians.textContent = osAberta; // Agora mostra O.S abertas

                const totalBase = totalContext || state.totalConfigurations;

                const progress = totalBase > 0 ? Math.round((completed / totalBase) * 100) : 0;

                elements.totalProgressBar.style.width = `${progress}%`;
                elements.totalProgressBar.textContent = `${progress}%`;
                elements.progressDescription.textContent = `${completed} de ${totalBase} configurações concluídas`;
            }

            function startAutoUpdate() {
                if (state.updateInterval) {
                    clearInterval(state.updateInterval);
                }
                if (state.updateTimerInterval) {
                    clearInterval(state.updateTimerInterval);
                }

                elements.updateTimer.classList.remove('hidden');

                updateTimerDisplay(5 * 60); 

                let secondsLeft = 5 * 60;
                state.updateTimerInterval = setInterval(() => {
                    secondsLeft--;
                    updateTimerDisplay(secondsLeft);

                    if (secondsLeft <= 0) {
                        clearInterval(state.updateTimerInterval);
                        loadData();
                    }
                }, 1000);

                state.updateInterval = setTimeout(() => {
                    loadData();
                }, 5 * 60 * 1000);

                state.lastUpdateTime = new Date();
            }

            function updateTimerDisplay(seconds) {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                elements.timerText.textContent = `Próxima atualização em ${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
            }

            function loadData() {
                if (!state.googleSheetsUrl) {
                    alert('Por favor, insira a URL do Google Sheets primeiro');
                    return;
                }
                loadFromUrl();
            }

            function loadFromUrl() {
                const url = elements.googleSheetsUrl.value;
                if (!url) {
                    alert('Por favor, cole a URL do Google Sheets');
                    return;
                }

                state.googleSheetsUrl = url;
                showLoading(true);

                try {
                    let spreadsheetId = '';
                    const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                    spreadsheetId = match && match[1] ? match[1] : url;

                    const exportUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=xlsx`;

                    fetch(exportUrl)
                        .then(response => {
                            if (!response.ok) throw new Error('Erro ao carregar a planilha. Verifique a URL e se a planilha é pública.');
                            return response.arrayBuffer();
                        })
                        .then(data => {
                            const workbook = XLSX.read(new Uint8Array(data), { type: 'array' });
                            processWorkbookNew(workbook);
                            showLoading(false);

                            startAutoUpdate();
                        })
                        .catch(error => {
                            alert(error.message);
                            console.error('Error loading Google Sheets:', error);
                            showLoading(false);
                        });
                } catch (error) {
                    alert('Erro ao processar a URL. Verifique se é uma URL válida do Google Sheets.');
                    console.error('Error processing Google Sheets URL:', error);
                    showLoading(false);
                }
            }

            function processWorkbook(workbook) {
                if (!workbook || !workbook.SheetNames || workbook.SheetNames.length === 0) {
                    alert('A planilha não contém abas.');
                    return;
                }

                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                if (!worksheet) {
                    alert('A planilha não contém dados.');
                    return;
                }

                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: null });

                if (!jsonData || jsonData.length < 2) {
                    alert('A planilha não contém dados suficientes.');
                    return;
                }

                const headers = jsonData[0] ? jsonData[0].map(h => h ? String(h).toLowerCase().trim() : '') : [];
                const tecnicoIndex = headers.findIndex(h => h.includes('atendente call'));
                const configuradoIndex = headers.findIndex(h => h.includes('configurado'));
                const filialIndex = headers.findIndex(h => h.includes('filial toledo fibra'));

                if (tecnicoIndex === -1 || configuradoIndex === -1) {
                    alert('A planilha deve conter colunas com os nomes "Atendente Call" e "Configurado"');
                    return;
                }

                if (filialIndex === -1) {
                    console.warn('Coluna "Filial Toledo FIbra" não encontrada. O filtro por região não funcionará.');
                }

                const dataRows = jsonData.slice(1);
                state.rawData = []; 
                state.filiais.clear();

                dataRows.forEach(row => {
                    if (row && row.length > Math.max(tecnicoIndex, configuradoIndex)) {
                        const tecnico = row[tecnicoIndex] ? String(row[tecnicoIndex]).trim() : null;
                        const configurado = row[configuradoIndex] ? String(row[configuradoIndex]).trim() : null;

                        if (tecnico && configurado && configurado !== '') {
                            if (techniciansMap.has(tecnico)) {
                                techniciansMap.set(tecnico, techniciansMap.get(tecnico) + 1);
                            } else {
                                techniciansMap.set(tecnico, 1);
                            }
                        }

                        if (tecnico) {
                            configurationsList.push({
                                tecnico: tecnico,
                                configurado: configurado
                            });
                        }
                    }
                });

                state.techniciansData = Array.from(techniciansMap.entries())
                    .map(([name, count]) => ({ name, count }))
                    .sort((a, b) => b.count - a.count);

                state.configurationsData = configurationsList;

                updatePodium();
            }

            function updatePodium() {
                if (!state.techniciansData || state.techniciansData.length === 0) {
                    alert('Nenhum técnico com configurações encontrado.');
                    return;
                }

                elements.podiumContainer.classList.remove('hidden');
                elements.emptyState.classList.add('hidden');

                const top3 = state.techniciansData.slice(0, 3);

                if (top3[0]) {
                    const first = top3[0];
                    elements.firstPlaceName.textContent = first.name || '--';
                    elements.firstPlaceCount.textContent = `${first.count || 0} configuraç${first.count !== 1 ? 'ões' : ''}`;
                    elements.firstPlaceAvatar.textContent = getInitials(first.name);
                    elements.firstPlaceAvatar.style.backgroundColor = getRandomColor(first.name);
                }

                if (top3[1]) {
                    const second = top3[1];
                    elements.secondPlaceName.textContent = second.name || '--';
                    elements.secondPlaceCount.textContent = `${second.count || 0} configuraç${second.count !== 1 ? 'ões' : ''}`;
                    elements.secondPlaceAvatar.textContent = getInitials(second.name);
                    elements.secondPlaceAvatar.style.backgroundColor = getRandomColor(second.name);
                }

                if (top3[2]) {
                    const third = top3[2];
                    elements.thirdPlaceName.textContent = third.name || '--';
                    elements.thirdPlaceCount.textContent = `${third.count || 0} configuraç${third.count !== 1 ? 'ões' : ''}`;
                    elements.thirdPlaceAvatar.textContent = getInitials(third.name);
                    elements.thirdPlaceAvatar.style.backgroundColor = getRandomColor(third.name);
                }

                if (state.configurationsData.length > 0) {
                    updateConfigurationsList(state.configurationsData);
                }

                setupCarousel();

                updateTechniciansList();

                fireConfettiForTop3();
            }

            function processWorkbookNew(workbook) {
                if (!workbook || !workbook.SheetNames || workbook.SheetNames.length === 0) {
                    alert('A planilha não contém abas.');
                    return;
                }

                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                if (!worksheet) {
                    alert('A planilha não contém dados.');
                    return;
                }

                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: null });

                if (!jsonData || jsonData.length < 2) {
                    alert('A planilha não contém dados suficientes.');
                    return;
                }

                const headers = jsonData[0] ? jsonData[0].map(h => h ? String(h).toLowerCase().trim() : '') : [];
                const tecnicoIndex = headers.findIndex(h => h.includes('atendente call'));
                const configuradoIndex = headers.findIndex(h => h.includes('configurado'));
                const refeitoIndex = headers.findIndex(h => h.includes('refeito'));
                const osAbertaIndex = headers.findIndex(h => h.includes('o.s aberta') || h.includes('os aberta'));

                if (tecnicoIndex === -1 || configuradoIndex === -1) {
                    alert('A planilha deve conter colunas com os nomes "Atendente Call" e "Configurado"');
                    return;
                }

                const dataRows = jsonData.slice(1);
                state.rawData = [];

                dataRows.forEach(row => {
                    if (row && row.length > 0) {
                        const tecnico = row[tecnicoIndex] ? String(row[tecnicoIndex]).trim() : null;
                        const configurado = row[configuradoIndex] ? String(row[configuradoIndex]).trim() : null;
                        const refeito = refeitoIndex !== -1 && row[refeitoIndex] ? String(row[refeitoIndex]).trim() : null;
                        const osAberta = osAbertaIndex !== -1 && row[osAbertaIndex] ? String(row[osAbertaIndex]).trim() : null;

                        if (tecnico) {
                            state.rawData.push({
                                tecnico,
                                configurado,
                                refeito,
                                osAberta
                            });
                        }
                    }
                });

                const techniciansMap = new Map();
                state.rawData.forEach(item => {
                    const { tecnico, configurado } = item;
                    if (configurado && configurado !== '') {
                        techniciansMap.set(tecnico, (techniciansMap.get(tecnico) || 0) + 1);
                    } else {
                        if (!techniciansMap.has(tecnico)) {
                            techniciansMap.set(tecnico, 0);
                        }
                    }
                });

                state.techniciansData = Array.from(techniciansMap.entries())
                    .map(([name, count]) => ({ name, count }))
                    .sort((a, b) => b.count - a.count);

                state.configurationsData = state.rawData;
                state.totalConfigurations = 57317; 

                const currentTotal = state.totalConfigurations;
                updatePodiumNew(currentTotal);
            }

            function updatePodiumNew(currentTotal) {
                if (!state.techniciansData) {
                    return;
                }

                checkForRankingChanges(state.techniciansData);

                elements.podiumContainer.classList.remove('hidden');
                elements.emptyState.classList.add('hidden');

                const top3 = state.techniciansData.slice(0, 3);

                [elements.firstPlaceName, elements.secondPlaceName, elements.thirdPlaceName].forEach(el => el.textContent = '--');
                [elements.firstPlaceCount, elements.secondPlaceCount, elements.thirdPlaceCount].forEach(el => el.textContent = '0 configurações');
                [elements.firstPlaceAvatar, elements.secondPlaceAvatar, elements.thirdPlaceAvatar].forEach(el => {
                    el.textContent = '--';
                    el.style.backgroundColor = '#555';
                });

                if (top3[0]) {
                    const first = top3[0];
                    elements.firstPlaceName.textContent = first.name || '--';
                    elements.firstPlaceCount.textContent = `${first.count || 0} configuraç${first.count !== 1 ? 'ões' : ''}`;
                    elements.firstPlaceAvatar.textContent = getInitials(first.name);
                    elements.firstPlaceAvatar.style.backgroundColor = getRandomColor(first.name);
                }

                if (top3[1]) {
                    const second = top3[1];
                    elements.secondPlaceName.textContent = second.name || '--';
                    elements.secondPlaceCount.textContent = `${second.count || 0} configuraç${second.count !== 1 ? 'ões' : ''}`;
                    elements.secondPlaceAvatar.textContent = getInitials(second.name);
                    elements.secondPlaceAvatar.style.backgroundColor = getRandomColor(second.name);
                }

                if (top3[2]) {
                    const third = top3[2];
                    elements.thirdPlaceName.textContent = third.name || '--';
                    elements.thirdPlaceCount.textContent = `${third.count || 0} configuraç${third.count !== 1 ? 'ões' : ''}`;
                    elements.thirdPlaceAvatar.textContent = getInitials(third.name);
                    elements.thirdPlaceAvatar.style.backgroundColor = getRandomColor(third.name);
                }

                updateConfigurationsList(state.configurationsData, currentTotal);

                setupCarousel();
                updateTechniciansList();
                fireConfettiForTop3();
            }

            function getInitials(name) {
                if (!name) return '--';

                const parts = name.split(' ');
                if (parts.length >= 2) {
                    return `${parts[0][0]}${parts[parts.length - 1][0]}`.toUpperCase();
                } else if (name.length >= 2) {
                    return name.substring(0, 2).toUpperCase();
                }
                return name.substring(0, 1).toUpperCase();
            }

            function getRandomColor(name) {
                if (!name) return '#999';

                let hash = 0;
                for (let i = 0; i < name.length; i++) {
                    hash = name.charCodeAt(i) + ((hash << 5) - hash);
                }

                const h = hash % 360;
                return `hsl(${h}, 70%, 60%)`;
            }

            initEventListeners();
            initWiFiSymbol();

            function toggleVoice() {
                state.voiceEnabled = !state.voiceEnabled;
                updateVoiceUI();

                if (state.voiceEnabled) {
                    speak('Sistema de voz ativado.');
                }
            }

            function updateVoiceUI() {
                if (state.voiceEnabled) {
                    elements.voiceIcon.className = 'fas fa-volume-up mr-2';
                    elements.voiceBtnText.textContent = 'Voz: On';
                    elements.voiceToggleBtn.classList.remove('bg-gray-600', 'hover:bg-gray-500');
                    elements.voiceToggleBtn.classList.add('bg-green-600', 'hover:bg-green-500');
                } else {
                    elements.voiceIcon.className = 'fas fa-volume-mute mr-2';
                    elements.voiceBtnText.textContent = 'Voz: Off';
                    elements.voiceToggleBtn.classList.remove('bg-green-600', 'hover:bg-green-500');
                    elements.voiceToggleBtn.classList.add('bg-gray-600', 'hover:bg-gray-500');
                }
            }

            function speak(text) {
                if (!window.speechSynthesis) return;

                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pt-BR';
                utterance.rate = 1.1;
                utterance.pitch = 1;

                window.speechSynthesis.speak(utterance);
            }

            function checkForRankingChanges(newTechniciansData) {
                if (!state.voiceEnabled || !state.previousRankings.size) {
                    updatePreviousRankings(newTechniciansData);
                    return;
                }

                let overtakes = [];

                for (let i = 0; i < newTechniciansData.length; i++) {
                    const tech = newTechniciansData[i];
                    const currentRank = i + 1;
                    const previousRank = state.previousRankings.get(tech.name);

                    if (previousRank && currentRank < previousRank) {
                        if (i + 1 < newTechniciansData.length) {
                            const techBelow = newTechniciansData[i + 1];
                            const prevRankBelow = state.previousRankings.get(techBelow.name);

                            if (prevRankBelow && prevRankBelow < previousRank) {
                                overtakes.push(`${tech.name} passou ${techBelow.name} no rank.`);
                            }
                        }
                    }
                }

                if (overtakes.length > 0) {
                    speak(overtakes[0]);
                }

                updatePreviousRankings(newTechniciansData);
            }

            function updatePreviousRankings(techniciansData) {
                state.previousRankings.clear();
                techniciansData.forEach((tech, index) => {
                    state.previousRankings.set(tech.name, index + 1);
                });
            }

            window.addEventListener('resize', () => {
                if (state.carouselSlides.length > 0) {
                    updateCarousel();
                }
            });
        });
    </script>

    <!-- Firebase SDK - Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>

    <div id="maintenanceOverlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 9999; justify-content: center; align-items: center;">
        <div style="text-align: center; color: white; max-width: 600px; padding: 40px;">
            <div style="font-size: 80px; margin-bottom: 30px; animation: rotate 3s linear infinite;">⚙️</div>
            <div style="font-size: 36px; margin-bottom: 20px; font-weight: bold;" id="maintenanceTitle">Sistema em
                Manutenção</div>
            <div style="font-size: 18px; line-height: 1.6; color: #ccc;" id="maintenanceMessage">
                Estamos realizando melhorias no sistema. Por favor, aguarde alguns instantes.
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alertModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 10000; justify-content: center; align-items: center;">
        <div
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5); animation: modalSlideIn 0.4s ease; position: relative;">
            <button onclick="closeAlertModal()"
                style="position: absolute; top: 15px; right: 15px; background: rgba(255, 255, 255, 0.2); border: none; color: white; font-size: 24px; cursor: pointer; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s;">
                ×
            </button>
            <div style="text-align: center; color: white;">
                <div style="font-size: 60px; margin-bottom: 20px;">🔔</div>
                <h2 id="alertModalTitle" style="font-size: 28px; margin-bottom: 15px; font-weight: bold;">Atenção</h2>
                <p id="alertModalMessage" style="font-size: 18px; line-height: 1.6; margin-bottom: 30px;">Mensagem de
                    alerta</p>
                <button onclick="closeAlertModal()"
                    style="background: white; color: #667eea; border: none; padding: 12px 30px; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);">
                    OK, Entendi
                </button>
            </div>
        </div>
    </div>

    <style>
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        #alertModal button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
    </style>

    <script>
        let isFirebaseConnected = false;

        window.addEventListener('load', () => {
            console.log('🔥 Inicializando Firebase para controle de manutenção...');

            if (initFirebase()) {
                isFirebaseConnected = true;
                console.log('✅ Firebase conectado! Monitorando status de manutenção...');

                listenToPageStatus((data) => {
                    console.log('📥 Status recebido do Firebase:', data);

                    if (data) {
                        checkMaintenanceMode(data);
                        handleRemoteCommands(data);
                    }
                });
            } else {
                console.warn('⚠️ Firebase não conectado. Modo de manutenção não disponível.');
            }
        });

        let lastAlertTimestamp = 0;
        let lastSpreadsheetTimestamp = 0;

        function checkMaintenanceMode(data) {
            const overlay = document.getElementById('maintenanceOverlay');

            if (data.maintenance) {
                overlay.style.display = 'flex';

                const title = document.getElementById('maintenanceTitle');
                const message = document.getElementById('maintenanceMessage');

                title.textContent = data.title || 'Sistema em Manutenção';
                message.textContent = data.message || 'Estamos realizando melhorias no sistema. Por favor, aguarde alguns instantes.';

                console.log('🔧 Modo manutenção ATIVADO');
            } else {
                overlay.style.display = 'none';
                console.log('✅ Modo manutenção DESATIVADO');
            }
        }

        function handleRemoteCommands(data) {
            if (data.loadSpreadsheet && data.spreadsheetUrl && data.timestamp) {
                if (data.timestamp > lastSpreadsheetTimestamp) {
                    lastSpreadsheetTimestamp = data.timestamp;

                    console.log('📥 Comando recebido: Carregar planilha', data.spreadsheetUrl);

                    const urlInput = document.getElementById('googleSheetsUrl');
                    if (urlInput) {
                        urlInput.value = data.spreadsheetUrl;

                        const loadBtn = document.getElementById('loadFromUrlBtn');
                        if (loadBtn) {
                            loadBtn.click();
                            console.log('✅ Planilha carregada automaticamente!');
                        }
                    }
                }
            }

            if (data.showAlert && data.alertMessage && data.alertTimestamp) {
                const displayedAlerts = JSON.parse(localStorage.getItem('displayedAlerts') || '[]');

                if (!displayedAlerts.includes(data.alertTimestamp)) {
                    console.log('🔔 Comando recebido: Mostrar alerta', data.alertMessage);

                    showAlertModal(data.alertTitle || 'Atenção', data.alertMessage, data.alertDuration || 0);

                    displayedAlerts.push(data.alertTimestamp);

                    if (displayedAlerts.length > 50) {
                        displayedAlerts.shift();
                    }

                    localStorage.setItem('displayedAlerts', JSON.stringify(displayedAlerts));
                } else {
                    console.log('ℹ️ Alerta já foi exibido anteriormente, ignorando...');
                }
            }
        }

        let alertCloseTimer = null;
        let alertCountdownInterval = null;

        // Mostrar modal de alerta
        function showAlertModal(title, message, duration = 0) {
            const modal = document.getElementById('alertModal');
            const modalTitle = document.getElementById('alertModalTitle');
            const modalMessage = document.getElementById('alertModalMessage');
            const okButton = modal.querySelector('button[onclick="closeAlertModal()"]');

            if (modal && modalTitle && modalMessage) {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modal.style.display = 'flex';

                if (alertCloseTimer) clearTimeout(alertCloseTimer);
                if (alertCountdownInterval) clearInterval(alertCountdownInterval);

                // Se duração > 0, configurar auto-close
                if (duration > 0) {
                    const durationMs = duration * 60 * 1000; // Converter minutos para ms
                    let remainingSeconds = duration * 60;

                    // Atualizar texto do botão com countdown
                    const updateButtonText = () => {
                        const minutes = Math.floor(remainingSeconds / 60);
                        const seconds = remainingSeconds % 60;
                        okButton.textContent = `OK (Fecha em ${minutes}:${seconds.toString().padStart(2, '0')})`;
                    };

                    updateButtonText();

                    // Countdown a cada segundo
                    alertCountdownInterval = setInterval(() => {
                        remainingSeconds--;
                        if (remainingSeconds > 0) {
                            updateButtonText();
                        } else {
                            clearInterval(alertCountdownInterval);
                        }
                    }, 1000);

                    // Fechar automaticamente após a duração
                    alertCloseTimer = setTimeout(() => {
                        closeAlertModal();
                    }, durationMs);

                    console.log(`✅ Alerta exibido: ${title} (Auto-close em ${duration} min)`);
                } else {
                    okButton.textContent = 'OK, Entendi';
                    console.log(`✅ Alerta exibido: ${title} (Até clicar OK)`);
                }
            }
        }

        // Fechar modal de alerta
        function closeAlertModal() {
            const modal = document.getElementById('alertModal');
            const okButton = modal.querySelector('button[onclick="closeAlertModal()"]');

            if (modal) {
                modal.style.display = 'none';

                if (alertCloseTimer) {
                    clearTimeout(alertCloseTimer);
                    alertCloseTimer = null;
                }
                if (alertCountdownInterval) {
                    clearInterval(alertCountdownInterval);
                    alertCountdownInterval = null;
                }

                // Resetar texto do botão
                if (okButton) {
                    okButton.textContent = 'OK, Entendi';
                }
            }
        }
    </script>
</body>

</html>